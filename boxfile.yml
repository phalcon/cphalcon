run.config:
  engine: php
  engine.config:
    runtime: php-7.1
    extensions:
      - apcu
      - ctype
      - curl
      - dom
      - fileinfo
      - gd
      - gmp
      - gettext
      - imagick
      - iconv
      - json
      - mbstring
      - memcached
      - memcache
      - mongodb
      - pdo
      - pdo_mysql
      - pdo_pgsql
      - pdo_sqlite
      - redis
      - session
      - simplexml
      - tokenizer
      - yaml
      - zephir_parser
      - xml
      - xmlwriter
      - zip
      - zlib
    zend_extensions:
      - opcache
    dev_zend_extensions:
      add:
        - xdebug
      rm:
        - opcache
  extra_packages:
    - autoconf
    - freefonts
    - freetype2
    - fontconfig
    - mysql-client
    - postgresql94-client
    - re2c
    - sqlite3
  extra_steps:
    #===========================================================================
    # PSR extension compilation
    - |
      (
        CURRENT_FOLDER=$(pwd)
        rm -fR $CURRENT_FOLDER/build/php-psr
        cd $CURRENT_FOLDER/build
        git clone --depth=1 https://github.com/jbboehr/php-psr.git
        cd php-psr
        set -e
        phpize
        ./configure --with-php-config=$(which php-config)
        make -j"$(getconf _NPROCESSORS_ONLN)"
        make install
        cd $CURRENT_FOLDER
        rm -fR $CURRENT_FOLDER/build/php-psr
        unset CURRENT_FOLDER
      )
    - echo -e 'extension=psr.so' >> "/data/etc/php/dev_php.ini"
    #===========================================================================
    # This is here so that Phalcon can be used right after compilation
    - echo -e 'extension=phalcon.so' >> "/data/etc/php/dev_php.ini"
    - echo -e 'opcache.enable_cli=1' >> "/data/etc/php/dev_php.ini"
    - echo -e 'apcu.enabled=1' >> "/data/etc/php/dev_php.ini"
    - echo -e 'apcu.enable_cli=1' >> "/data/etc/php/dev_php.ini"

#data.beanstalkd:
#  image: phalcon/beanstalkd

data.memcached:
  image: nanobox/memcached:1.4

data.mongodb:
  image: nanobox/mongodb:3.0

data.mysql:
  image: nanobox/mysql:5.7

data.postgres:
  image: nanobox/postgresql:9.4

data.redis :
  image : nanobox/redis:3.2
